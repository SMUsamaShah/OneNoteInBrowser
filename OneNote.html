<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneNote-like Interface</title>
    <style>
        /* Reset default margins and set full height */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; /* Enable scrollbars when content overflows */
        }
        /* Container to handle scrollbars */
        #canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scrollbars on this container */
            background: #f0f0f0; /* Match background with canvas */
        }
        /* Infinite canvas styles */
        #infinite-canvas {
            position: relative;
            min-width: 100%;
            min-height: 100%;
            background: #f0f0f0;
            padding: 20px;
            box-sizing: border-box;
        }
        
        /* Text box container styles */
        .text-box {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;

            height: fit-content !important;
            
            /*padding: 5px;*/
            /*min-width: 100px;*/
            /*min-height: 30px;*/
            /*resize: horizontal; !* Allow horizontal resizing *!*/
            /*overflow: hidden; !* Hide overflow for auto height *!*/
        }
        /* Header for dragging */
        .text-box-header {
            cursor: move;
            background: #eee;
            padding: 2px;
            border-bottom: 1px solid #ccc;
        }
        /* Text content styles */
        .text-box-content {
            outline: none;
            
            width: 200px;
            min-height: 50px;
            min-width: 100px;
            /*border: 1px solid #ccc;*/
            padding: 10px;
            overflow: auto;
            resize: horizontal;
            max-width: 100%;
            white-space: pre-wrap; /* Allow wrapping of text */
            overflow-wrap: break-word; /* Enable breaking of long words */
        }
        .resizable {
            width: 200px;
            min-height: 50px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow: auto;
            resize: horizontal;
            max-width: 100%;
            white-space: pre-wrap; /* Allow wrapping of text */
            overflow-wrap: break-word; /* Enable breaking of long words */
        }
        /* Image container styles */
        .image-container {
            position: absolute;
            cursor: move; /* Indicate draggable */
            max-width: 300px;
            max-height: 300px;
        }
        .image-container img {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<!-- Main canvas container -->
<div id="canvas-container">
    <div id="infinite-canvas"></div>
</div>

<script>
  const canvas = document.getElementById('infinite-canvas');
  const canvasContainer = document.getElementById('canvas-container');
  let isMouseDown = false;
  let clickX, clickY;

  // Create a new text box upon clicking on the canvas
  canvas.addEventListener('mousedown', (e) => {
    if (e.target === canvas) {
      isMouseDown = true;
      clickX = e.pageX;
      clickY = e.pageY;
    }
  });

  canvas.addEventListener('mouseup', (e) => {
    if (isMouseDown && e.target === canvas) {
      const distance = Math.sqrt((e.pageX - clickX) ** 2 + (e.pageY - clickY) ** 2);
      const isEmptyDragOnPage = distance > 5; // Change threshold as needed
      if (!isEmptyDragOnPage) {
        createTextBox(e.clientX + canvasContainer.scrollLeft, e.clientY + canvasContainer.scrollTop);
      }
    }
    isMouseDown = false;
  });

  // Function to create a new text box at (x, y) coordinates
  function createTextBox(x, y) {
    const box = document.createElement('div');
    box.className = 'text-box';
    // box.className = 'resizable';
    box.style.left = `${x}px`;
    box.style.top = `${y}px`;

    const header = document.createElement('div');
    header.className = 'text-box-header';
    box.appendChild(header);

    const content = document.createElement('div');
    content.className = 'text-box-content';
    // content.className = 'resizable';
    content.contentEditable = true;
    box.appendChild(content);

    canvas.appendChild(box);
    content.focus();

    makeBoxDraggable(box, header);
    updateCanvasSize();

    // Adjust box height automatically when content changes
    content.addEventListener('input', () => adjustHeight(box, content));
  }

  // Make text boxes draggable through the header
  function makeBoxDraggable(box, handle) {
    let offsetX, offsetY;

    handle.addEventListener('mousedown', (e) => {
      offsetX = e.clientX - box.offsetLeft;
      offsetY = e.clientY - box.offsetTop;
      document.onmousemove = (e) => {
        box.style.left = `${e.clientX - offsetX}px`;
        box.style.top = `${e.clientY - offsetY}px`;
        updateCanvasSize();
      };
      document.onmouseup = () => document.onmousemove = document.onmouseup = null;
    });
  }

  // Adjust the height of the box automatically with the content
  function adjustHeight(box, content) {
    content.style.height = 'auto';
    box.style.height = `${content.scrollHeight + 15}px`; // Adjust height based on content
    updateCanvasSize();
  }

  // Handle image pasting
  document.addEventListener('paste', (e) => {
    const items = e.clipboardData.items;
    for (let item of items) {
      if (item.type.indexOf('image') !== -1) {
        const blob = item.getAsFile();
        const reader = new FileReader();
        reader.onload = (e) => createImage(e.target.result);
        reader.readAsDataURL(blob);
      }
    }
  });

  // Create and position a new image
  function createImage(src) {
    const container = document.createElement('div');
    container.className = 'image-container';
    const img = document.createElement('img');
    img.src = src;
    container.appendChild(img);

    canvas.appendChild(container);

    const rect = canvas.getBoundingClientRect();
    container.style.left = `${window.pageXOffset + rect.width / 2}px`;
    container.style.top = `${window.pageYOffset + rect.height / 2}px`;

    makeImageDraggable(container);
    updateCanvasSize();
  }

  // Make images draggable
  function makeImageDraggable(container) {
    let offsetX, offsetY;

    container.addEventListener('mousedown', (e) => {
      offsetX = e.clientX - container.offsetLeft;
      offsetY = e.clientY - container.offsetTop;
      document.onmousemove = (e) => {
        container.style.left = `${e.clientX - offsetX}px`;
        container.style.top = `${e.clientY - offsetY}px`;
        updateCanvasSize();
      };
      document.onmouseup = () => document.onmousemove = document.onmouseup = null;
    });
  }

  // Function to expand canvas size to fit contents
  function updateCanvasSize() {
    const elements = canvas.children;
    let maxRight = 0;
    let maxBottom = 0;

    for (let element of elements) {
      const rect = element.getBoundingClientRect();
      maxRight = Math.max(maxRight, rect.right + canvasContainer.offsetWidth);
      maxBottom = Math.max(maxBottom, rect.bottom + canvasContainer.offsetHeight);
    }

    canvas.style.width = `${Math.max(maxRight + 1000, canvasContainer.offsetWidth)}px`;
    canvas.style.height = `${Math.max(maxBottom + 1000, canvasContainer.offsetHeight)}px`;
  }

  // Extend canvas on mouse wheel scroll as needed
  document.addEventListener('wheel', (e) => updateCanvasSize());
  // Initial canvas expansion to start
  updateCanvasSize();
</script>
</body>
</html>
